<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Details | SomuNexus</title>
    <link rel="icon" type="image/png" href="icon/Mekxus_logo_no bg.png">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --gold: #d4af37; --dark: #0a0a0a; --gray: #1a1a1a; }
        body { background: var(--dark); color: white; font-family: 'Poppins', sans-serif; margin: 0; }
        .product-page-container { max-width: 1200px; margin: 50px auto; padding: 20px; display: grid; grid-template-columns: 1fr 1fr; gap: 40px; }
        .image-section { position: sticky; top: 20px; }
        .main-img-container { width: 100%; aspect-ratio: 1/1; background: var(--gray); border-radius: 15px; overflow: hidden; border: 1px solid #333; cursor: zoom-in; }
        .main-img-container img { width: 100%; height: 100%; object-fit: contain; transition: transform 0.3s ease; }
        .thumb-gallery { display: flex; gap: 10px; margin-top: 15px; overflow-x: auto; }
        .thumb-gallery img { width: 80px; height: 80px; border-radius: 8px; cursor: pointer; border: 2px solid transparent; opacity: 0.6; }
        .thumb-gallery img.active { border-color: var(--gold); opacity: 1; }
        .info-section h1 { color: var(--gold); font-size: 2rem; margin-bottom: 10px; }
        .price-tag { font-size: 1.8rem; color: #fff; margin-bottom: 20px; font-weight: bold; }
        .detailed-description { grid-column: span 2; margin-top: 50px; border-top: 1px solid #333; padding-top: 30px; }
        .desc-text { line-height: 1.8; color: #ccc; white-space: pre-line; margin-bottom: 30px; }
        .desc-images img { width: 100%; border-radius: 10px; margin-bottom: 20px; }
        @media (max-width: 768px) { .product-page-container { grid-template-columns: 1fr; } .detailed-description { grid-column: span 1; } }
        /* ‡¶á‡¶Æ‡ßá‡¶ú ‡¶∏‡ßá‡¶ï‡¶∂‡¶®‡¶ï‡ßá ‡¶∏‡ßç‡¶ü‡¶ø‡¶ï‡¶ø ‡¶è‡¶¨‡¶Ç ‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡¶ú‡¶ø‡¶∂‡¶®‡¶æ‡¶≤ ‡¶ï‡¶∞‡¶æ */
.image-section {
    position: sticky;
    top: 20px;
    transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: 10;
}

/* ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶≤ ‡¶ï‡¶∞‡¶≤‡ßá ‡¶á‡¶Æ‡ßá‡¶ú ‡¶õ‡ßã‡¶ü ‡¶π‡¶ì‡ßü‡¶æ‡¶∞ ‡¶ï‡ßç‡¶≤‡¶æ‡¶∏ (‡¶è‡¶ü‡¶ø JS ‡¶¶‡¶ø‡ßü‡ßá ‡¶ï‡¶®‡ßç‡¶ü‡ßç‡¶∞‡ßã‡¶≤ ‡¶π‡¶¨‡ßá) */
.image-section.scrolled {
    transform: scale(0.7); /* ‡¶á‡¶Æ‡ßá‡¶ú ‡ß©‡ß¶% ‡¶õ‡ßã‡¶ü ‡¶π‡¶¨‡ßá */
    top: 10px;
    opacity: 0.9;
}

/* ‡¶°‡¶ø‡¶ü‡ßá‡¶á‡¶≤‡¶∏ ‡¶∏‡ßá‡¶ï‡¶∂‡¶® ‡¶Ø‡ßá‡¶® ‡¶á‡¶Æ‡ßá‡¶ú‡ßá‡¶∞ ‡¶®‡¶ø‡¶ö‡ßá ‡¶®‡¶æ ‡¶¢‡ßã‡¶ï‡ßá */
.detailed-description {
    position: relative;
    background: var(--dark);
    z-index: 11; /* ‡¶á‡¶Æ‡ßá‡¶ú‡ßá‡¶∞ ‡¶ö‡ßá‡ßü‡ßá ‡¶â‡¶™‡¶∞‡ßá ‡¶•‡¶æ‡¶ï‡¶¨‡ßá */
    margin-top: 50px;
    padding-top: 30px;
}
.trust-badges {
    margin-top: 30px;
    display: flex;
    flex-direction: column;
    gap: 15px;
    background: #151515;
    padding: 20px;
    border-radius: 12px;
    border: 1px solid #333;
}

.badge-item {
    display: flex;
    align-items: center;
    gap: 15px;
}

.badge-item i {
    font-size: 1.5rem;
    color: var(--gold);
    width: 30px;
}

.badge-item strong {
    display: block;
    font-size: 0.95rem;
    color: var(--gold);
}

.badge-item p {
    font-size: 0.85rem;
    color: #888;
    margin: 0;
}
.back-home {
    position: fixed;
    top: 20px;
    left: 20px;
    z-index: 1000;
    background: rgba(212, 175, 55, 0.9); /* Gold color */
    color: black;
    padding: 10px 18px;
    border-radius: 50px;
    text-decoration: none;
    font-weight: bold;
    box-shadow: 0 4px 15px rgba(0,0,0,0.5);
    transition: 0.3s;
    display: flex;
    align-items: center;
    gap: 8px;
}

.back-home:hover {
    background: white;
    transform: scale(1.05);
}

@media (max-width: 768px) {
    .back-home {
        top: 10px;
        left: 10px;
        font-size: 14px;
        padding: 8px 15px;
    }
}
.main-header {
    background: #111; /* ‡¶π‡¶æ‡¶≤‡¶ï‡¶æ ‡¶ï‡¶æ‡¶≤‡ßã */
    border-bottom: 1px solid #333;
    padding: 10px 0;
    position: sticky;
    top: 0;
    z-index: 1000;
}

.header-container {
    max-width: 1200px;
    margin: 0 auto;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0 20px;
}

.brand-logo {
    font-size: 24px;
    font-weight: 800;
    color: white;
    text-decoration: none;
    letter-spacing: 1.5px;
    text-transform: uppercase;
}

.brand-logo span {
    color: var(--gold); /* ‡¶ó‡ßã‡¶≤‡ßç‡¶° ‡¶ï‡¶æ‡¶≤‡¶æ‡¶∞ */
    font-style: italic;
}

.nav-back {
    color: #888;
    font-size: 20px;
    text-decoration: none;
    transition: 0.3s;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    background: #1a1a1a;
}

.nav-back:hover {
    color: var(--gold);
    background: #222;
}

/* ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶õ‡ßã‡¶ü ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶ú‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡ßá‡¶®‡ßç‡¶ü */
@media (max-width: 768px) {
    .brand-logo {
        font-size: 20px;
    }
}
/* ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶® ‡¶¨‡¶æ‡¶ü‡¶® ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶á‡¶®‡¶æ‡¶∞ */
.action-btns {
    display: flex;
    gap: 15px;
    margin-top: 25px;
}

/* ADD TO CART ‡¶¨‡¶æ‡¶ü‡¶® ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ */
.btn-cart {
    flex: 1;
    padding: 15px;
    background: transparent;
    border: 2px solid #d4af37;
    color: #d4af37;
    font-weight: bold;
    border-radius: 8px;
    cursor: pointer;
    transition: 0.3s;
    text-transform: uppercase;
    font-size: 14px;
}

.btn-cart:hover {
    background: #d4af37;
    color: #000;
}

/* WhatsApp BUY NOW ‡¶¨‡¶æ‡¶ü‡¶® (‡¶ó‡¶∞‡ßç‡¶ú‡¶ø‡¶Ø‡¶º‡¶æ‡¶∏ ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶®) */
.btn-whatsapp {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    background: linear-gradient(135deg, #25d366 0%, #128c7e 100%);
    color: white !important;
    text-decoration: none;
    padding: 15px;
    border-radius: 8px;
    font-weight: bold;
    font-size: 15px;
    text-transform: uppercase;
    position: relative;
    overflow: hidden;
    transition: 0.4s;
    box-shadow: 0 4px 15px rgba(37, 211, 102, 0.3);
    animation: whatsappPulse 2s infinite; /* ‡¶ó‡ßç‡¶≤‡ßã ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶®‡¶ø‡¶Æ‡ßá‡¶∂‡¶® */
}

/* ‡¶¨‡¶æ‡¶ü‡¶®‡ßá‡¶∞ ‡¶≠‡ßá‡¶§‡¶∞ ‡¶¶‡¶ø‡ßü‡ßá ‡¶Ø‡¶æ‡¶ì‡ßü‡¶æ‡¶∞ Shine ‡¶á‡¶´‡ßá‡¶ï‡ßç‡¶ü */
.btn-whatsapp::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(120deg, transparent, rgba(255,255,255,0.3), transparent);
    transition: 0.5s;
    animation: shineEffect 3s infinite;
}

/* ‡¶π‡ßã‡¶≠‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶≤‡ßá ‡¶è‡¶ï‡¶ü‡ßÅ ‡¶¨‡ßú ‡¶π‡¶¨‡ßá */
.btn-whatsapp:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(37, 211, 102, 0.5);
    filter: brightness(1.1);
}

/* ‡¶ó‡ßç‡¶≤‡ßã ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶®‡¶ø‡¶Æ‡ßá‡¶∂‡¶® ‡¶≤‡¶ú‡¶ø‡¶ï */
@keyframes whatsappPulse {
    0% { box-shadow: 0 0 0 0 rgba(37, 211, 102, 0.5); }
    70% { box-shadow: 0 0 0 12px rgba(37, 211, 102, 0); }
    100% { box-shadow: 0 0 0 0 rgba(37, 211, 102, 0); }
}

@keyframes shineEffect {
    0% { left: -100%; }
    20% { left: 100%; }
    100% { left: 100%; }
}

/*chat css*/
/* ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü ‡¶â‡¶á‡¶ú‡ßá‡¶ü ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶á‡¶®‡¶æ‡¶∞ */
#nexus-chat-wrapper { position: fixed; bottom: 10px; right: 25px; z-index: 10000; font-family: 'Poppins', sans-serif; }

/* ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü ‡¶¨‡¶æ‡¶¨‡¶≤ ‡¶¨‡¶æ‡¶ü‡¶® */
#chat-bubble { bottom: 20px; right: 10px; width: 40px; height: 40px; background: linear-gradient(135deg, #d4af37, #aa8928); border: none; border-radius: 50%; color: black; font-size: 26px; cursor: pointer; box-shadow: 0 5px 20px rgba(212, 175, 55, 0.4); transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); position: relative; }
#chat-bubble:hover { transform: scale(1.1) rotate(5deg); }

/* ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü ‡¶â‡¶á‡¶®‡ßç‡¶°‡ßã */
#nexus-chat-window { width: 360px; height: 500px; background: #0a0a0a; border: 1px solid #333; border-radius: 20px; position: absolute; bottom: 80px; right: 0; display: flex; flex-direction: column; overflow: hidden; transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); transform-origin: bottom right; box-shadow: 0 10px 40px rgba(0,0,0,0.8); }
.chat-hidden { opacity: 0; transform: scale(0) translateY(100px); pointer-events: none; }

/* ‡¶π‡ßá‡¶°‡¶æ‡¶∞ ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶® */
.chat-header { background: #151515; padding: 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #222; }
.header-info { display: flex; align-items: center; gap: 12px; }
.header-info img { width: 38px; height: 38px; border-radius: 50%; border: 1px solid #d4af37; background: #000; }
.header-info h4 { margin: 0; color: #d4af37; font-size: 15px; font-weight: 600; }
.status-dot { width: 8px; height: 8px; background: #25d366; border-radius: 50%; display: inline-block; box-shadow: 0 0 10px #25d366; }
.close-chat-btn { background: transparent; border: none; color: #888; cursor: pointer; font-size: 18px; }

/* ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü ‡¶¨‡¶°‡¶ø */
.chat-body { flex: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 12px; scroll-behavior: smooth; }
.msg { padding: 10px 16px; border-radius: 18px; max-width: 85%; font-size: 13.5px; line-height: 1.5; animation: msgFade 0.3s ease-out; }
@keyframes msgFade { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

.bot-msg { background: #1a1a1a; color: #ddd; align-self: flex-start; border-bottom-left-radius: 2px; border: 1px solid #222; }
.user-msg { background: linear-gradient(135deg, #d4af37, #b8962e); color: black; align-self: flex-end; border-bottom-right-radius: 2px; font-weight: 500; }

/* ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü ‡¶´‡ßÅ‡¶ü‡¶æ‡¶∞ */
.chat-footer { padding: 12px; background: #151515; display: flex; gap: 10px; border-top: 1px solid #222; }
.chat-footer input { flex: 1; background: #000; border: 1px solid #333; padding: 10px 15px; border-radius: 25px; color: white; outline: none; font-size: 13px; }
.chat-footer input:focus { border-color: #d4af37; }
#send-btn { background: #d4af37; border: none; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; transition: 0.3s; color: black; }
#send-btn:hover { background: #fff; transform: scale(1.05); }

/* ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶∞‡ßá‡¶∏‡¶™‡¶®‡ßç‡¶∏‡¶ø‡¶≠‡¶®‡ßá‡¶∏ */
@media (max-width: 480px) {
    #nexus-chat-window { width: calc(100vw - 40px); height: 75vh; right: -10px; bottom: 80px; }
    #nexus-chat-wrapper { bottom: 20px; right: 20px; }
}
#admin-typing-status {
    animation: blink 1.5s infinite;
}

@keyframes blink {
    0% { opacity: 1; }
    50% { opacity: 0.5; }
    100% { opacity: 1; }
}

.custom-context-menu {
    user-select: none;
    -webkit-user-select: none;
    animation: fadeIn 0.2s ease-out;
}

@keyframes fadeIn {
    from { opacity: 0; transform: scale(0.9); }
    to { opacity: 1; transform: scale(1); }
}
/*End chat css*/
    </style>
</head>
<body>
<a href="index.html" class="back-home">
    <i class="fas fa-home"></i> Back to Shop
</a>
<header class="main-header">
    <div class="header-container">
        <a href="index.html" class="nav-back">
            <i class="fas fa-chevron-left"></i>
        </a>
        
        <a href="index.html" class="brand-logo">
            Somu<span>Nexus</span>
        </a>

        <div style="width: 40px;"></div>
    </div>
</header>

<div class="product-page-container">
    <div class="image-section">
        <div class="main-img-container" id="zoomContainer">
            <img id="mainImg" src="" alt="Product Image">
        </div>
        <div class="thumb-gallery" id="thumbGallery"></div>
    </div>

    <div class="info-section">
        <h1 id="pTitle">Loading...</h1>
        <div class="price-tag" id="pPrice">0 TK</div>
        <p id="pShortDesc" style="color: #bbb;"></p>
        <div class="action-btns">
            <button class="btn-cart" id="detailsAddToCartBtn" onclick="addToCartFromDetails()">ADD TO CART</button>
            <a href="#" id="waBtn" target="_blank" class="btn-whatsapp"><i class="fab fa-whatsapp"></i> BUY NOW</a>
        </div>

    <div class="trust-badges">
    <div class="badge-item">
        <i class="fas fa-shipping-fast"></i>
        <div>
            <strong>Home Delivery</strong>
            <p>Inside Dhaka: 2-3 Days | Outside: 3-5 Days</p>
        </div>
    </div>
    <div class="badge-item">
        <i class="fas fa-shield-alt"></i>
        <div>
            <strong>Official Warranty</strong>
            <p id="pWarranty">Loading Warranty...</p>
        </div>
    </div>
    <div class="badge-item">
        <i class="fas fa-check-circle"></i>
        <div>
            <strong>7 Days Replacement</strong>
            <p>100% money back guarantee for defects</p>
        </div>
    </div>
</div>
    </div>

    <div class="detailed-description">
        <h2 style="color: var(--gold);">Product Details</h2>
        <div id="pLongDescText" class="desc-text"></div>
        <div id="pDescImages" class="desc-images"></div>
    </div>
</div>

<div id="nexus-chat-wrapper">
    <div id="nexus-chat-window" class="chat-hidden">
        <div class="chat-header">
            <div class="header-info">
                <img src="icon/Mekxus_logo_no bg.png" alt="SomuNexus Logo">
                <div>
                    <h4>SomuNexus Support</h4>
                    <span class="status-dot"></span> <small>Online</small>
                    <small id="admin-typing-status" style="color: #25d366; display: none; font-style: italic;">Support is typing...</small>
                </div>
            </div>
            <button onclick="toggleChat()" class="close-chat-btn"><i class="fas fa-times"></i></button>
        </div>
        
        <div id="chat-messages" class="chat-body">
            <div class="msg bot-msg">‡¶π‡ßç‡¶Ø‡¶æ‡¶≤‡ßã! SomuNexus-‡¶è ‡¶Ü‡¶™‡¶®‡¶æ‡¶ï‡ßá ‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ‡•§ ‡¶Ü‡¶Æ‡¶ø ‡¶ï‡ßÄ‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡¶æ‡¶π‡¶æ‡¶Ø‡ßç‡¶Ø ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶ø?</div>
        </div>

        <div class="chat-footer">
            <input type="text" id="chat-input" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®..." autocomplete="off">
            <button id="send-btn" onclick="sendNexusMessage()"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>

    <button id="chat-bubble" onclick="toggleChat()">
        <i class="fas fa-comment-dots"></i>
        <span class="notification-badge" id="chat-notify" style="display:none;">1</span>
    </button>
</div>

    <button id="chat-bubble" onclick="toggleChat()">
        <i class="fas fa-comment-dots"></i>
        <span class="notification-badge" id="chat-notify" style="display:none;">1</span>
    </button>
</div>

<script type="module">
    import { initializeApp, getApps, getApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
    import { getDatabase, ref, onValue, push, set } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-database.js";

    // ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¶‡ßá‡¶ì‡ßü‡¶æ Firebase ‡¶ï‡¶®‡¶´‡¶ø‡¶ó
    const firebaseConfig = {
        apiKey: "AIzaSyDNv18tFenJP9XpyL7cr9BaA3vg-gLUC3U",
        authDomain: "somunexas.firebaseapp.com",
        databaseURL: "https://somunexas-default-rtdb.firebaseio.com",
        projectId: "somunexas",
        storageBucket: "somunexas.firebasestorage.app",
        messagingSenderId: "880413975961",
        appId: "1:880413975961:web:838932e24b0644473b1f08",
        measurementId: "G-WL3RCDT4JS"
    };

    // ‡¶°‡ßÅ‡¶™‡ßç‡¶≤‡¶ø‡¶ï‡ßá‡¶ü ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶è‡¶∞‡¶∞ ‡¶è‡ßú‡¶æ‡¶®‡ßã‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ö‡ßá‡¶ï
    const app = !getApps().length ? initializeApp(firebaseConfig) : getApp();
    const db = getDatabase(app);

    // URL ‡¶•‡ßá‡¶ï‡ßá ‡¶Ü‡¶á‡¶°‡¶ø ‡¶®‡ßá‡¶ì‡ßü‡¶æ
    const urlParams = new URLSearchParams(window.location.search);
    const productId = urlParams.get('id');

    if (productId) {
        const productsRef = ref(db, 'products');
        onValue(productsRef, (snapshot) => {
            const data = snapshot.val();
            if (data) {
                // ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶°‡¶æ‡¶ü‡¶æ‡¶¨‡ßá‡¶ú‡ßá‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶´‡¶ø‡¶≤‡ßç‡¶°‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ö ‡¶ï‡¶∞‡¶æ
                const productKey = Object.keys(data).find(key => data[key].id == productId);
                const product = data[productKey];

                if (product) {
                    // ‡ßß. ‡¶¨‡ßá‡¶∏‡¶ø‡¶ï ‡¶§‡¶•‡ßç‡¶Ø ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ
                    document.getElementById('pTitle').innerText = product.name;
                    document.getElementById('pPrice').innerText = (product.currentPrice || product.price) + " TK";
                    document.getElementById('pShortDesc').innerText = product.desc || "";
                    document.getElementById('pWarranty').innerText = product.warranty || "No Official Warranty";
                    
                    const longDesc = document.getElementById('pLongDescText');
                    if(longDesc) longDesc.innerText = product.longDescription || "‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶§‡¶•‡ßç‡¶Ø ‡¶∂‡ßÄ‡¶ò‡ßç‡¶∞‡¶á ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶¨‡ßá‡•§";

                    // ‡ß®. ‡¶á‡¶Æ‡ßá‡¶ú ‡¶π‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶°‡¶≤‡¶ø‡¶Ç
                    const mainImg = document.getElementById('mainImg');
                    // images ‡¶Ö‡¶•‡¶¨‡¶æ media ‡¶Ø‡ßá ‡¶®‡¶æ‡¶Æ‡ßá‡¶á ‡¶•‡¶æ‡¶ï‡ßÅ‡¶ï ‡¶°‡¶æ‡¶ü‡¶æ ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßá ‡¶®‡ßá‡¶¨‡ßá
                    const allImages = product.images || (product.media ? product.media.map(m => m.url) : []);
                    
                    if(allImages.length > 0) {
                        mainImg.src = allImages[0];
                        const gallery = document.getElementById('thumbGallery');
                        if(gallery) {
                            gallery.innerHTML = ''; 
                            allImages.forEach((url, index) => {
                                const img = document.createElement('img');
                                img.src = url;
                                if(index === 0) img.classList.add('active');
                                img.onclick = () => {
                                    mainImg.src = url;
                                    document.querySelectorAll('.thumb-gallery img').forEach(i => i.classList.remove('active'));
                                    img.classList.add('active');
                                };
                                gallery.appendChild(img);
                            });
                        }
                    }

                    // ‡ß©. ‡¶°‡ßá‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡¶∂‡¶® ‡¶á‡¶Æ‡ßá‡¶ú (‡¶Ø‡¶¶‡¶ø ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶•‡ßá‡¶ï‡ßá ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ ‡¶•‡¶æ‡¶ï‡ßá)
                    const descDiv = document.getElementById('pDescImages');
                    if(descDiv) {
                        descDiv.innerHTML = '';
                        if(product.descriptionImages) {
                            product.descriptionImages.forEach(url => {
                                const img = document.createElement('img');
                                img.src = url;
                                descDiv.appendChild(img);
                            });
                        }
                    }

                    // ‡ß™. WhatsApp ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï
                    const waBtn = document.getElementById('waBtn');
                    if(waBtn) {
                        waBtn.href = `https://wa.me/8801826435150?text=Hello, I want to buy ${product.name} (ID: ${product.id})`;
                    }
                    // --- ‡ß´. ‡¶∏‡ßç‡¶ü‡¶ï ‡¶ö‡ßá‡¶ï ‡¶è‡¶¨‡¶Ç ‡¶¨‡¶æ‡¶ü‡¶® ‡¶Ü‡¶™‡¶°‡ßá‡¶ü (‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶¨‡¶∏‡¶æ‡¶ì) ---
                    let stockVal = 0;
                    if (product.stock !== undefined && product.stock !== null && product.stock !== "") {
                        stockVal = parseInt(product.stock);
                    }

                    const cartBtn = document.getElementById('detailsAddToCartBtn');

                    if (stockVal <= 0) {
                        // ‡¶∏‡ßç‡¶ü‡¶ï ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶¨‡¶æ‡¶ü‡¶® "STOCK OUT" ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá
                        if(cartBtn) {
                            cartBtn.innerText = "STOCK OUT";
                            cartBtn.disabled = true;
                            cartBtn.style.background = "#444";
                            cartBtn.style.color = "#888";
                            cartBtn.style.borderColor = "#444";
                            cartBtn.style.cursor = "not-allowed";
                        }
                        // ‡¶π‡ßã‡ßü‡¶æ‡¶ü‡¶∏‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶¨‡¶æ‡¶ü‡¶® ‡¶∏‡ßç‡¶ü‡¶ï ‡¶Ü‡¶â‡¶ü ‡¶Æ‡ßã‡¶°
                        if(waBtn) {
                            waBtn.style.opacity = "0.6";
                            waBtn.style.pointerEvents = "none"; 
                            waBtn.innerHTML = `<i class="fab fa-whatsapp"></i> STOCK OUT`;
                        }
                    } else {
                        // ‡¶∏‡ßç‡¶ü‡¶ï ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶¨‡¶æ‡¶ü‡¶® ‡¶∏‡ßç‡¶¨‡¶æ‡¶≠‡¶æ‡¶¨‡¶ø‡¶ï ‡¶•‡¶æ‡¶ï‡¶¨‡ßá
                        if(cartBtn) {
                            cartBtn.innerText = "ADD TO CART";
                            cartBtn.disabled = false;
                            cartBtn.style.background = "transparent";
                            cartBtn.style.color = "#d4af37";
                            cartBtn.style.borderColor = "#d4af37";
                            cartBtn.style.cursor = "pointer";
                        }
                        if(waBtn) {
                            waBtn.style.opacity = "1";
                            waBtn.style.pointerEvents = "auto";
                            waBtn.innerHTML = `<i class="fab fa-whatsapp"></i> BUY NOW`;
                        }
                    }
                    // --- ‡¶∏‡ßç‡¶ü‡¶ï ‡¶ö‡ßá‡¶ï ‡¶∂‡ßá‡¶∑ ---
                }
            }
        });
    }

    // ‡ß´. ‡¶ï‡ßã‡ßü‡¶æ‡¶®‡ßç‡¶ü‡¶ø‡¶ü‡¶ø ‡¶¨‡¶æ‡¶ü‡¶® ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
    window.updateQty = function(val) {
        const qtyVal = document.getElementById('qtyVal');
        let current = parseInt(qtyVal.innerText);
        qtyVal.innerText = Math.max(1, current + val);
    };

    // ‡ß¨. ‡¶ú‡ßÅ‡¶Æ ‡¶á‡¶´‡ßá‡¶ï‡ßç‡¶ü (‡¶°‡ßá‡¶∏‡ßç‡¶ï‡¶ü‡¶™‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø)
    const zoomContainer = document.getElementById('zoomContainer');
    const mainImg = document.getElementById('mainImg');
    if(zoomContainer && mainImg) {
        zoomContainer.addEventListener('mousemove', (e) => {
            const { left, top, width, height } = zoomContainer.getBoundingClientRect();
            const x = ((e.pageX - left) / width) * 100;
            const y = ((e.pageY - top) / height) * 100;
            mainImg.style.transformOrigin = `${x}% ${y}%`;
            mainImg.style.transform = "scale(1.8)";
        });
        zoomContainer.addEventListener('mouseleave', () => {
            mainImg.style.transform = "scale(1)";
        });
}
window.addEventListener('scroll', () => {
    const imageSection = document.querySelector('.image-section');
    if (window.scrollY > 200) { // ‡ß®‡ß¶‡ß¶ ‡¶™‡¶ø‡¶ï‡ßç‡¶∏‡ßá‡¶≤ ‡¶®‡¶ø‡¶ö‡ßá ‡¶®‡¶æ‡¶Æ‡¶≤‡ßá ‡¶á‡¶Æ‡ßá‡¶ú ‡¶õ‡ßã‡¶ü ‡¶π‡¶¨‡ßá
        imageSection.classList.add('scrolled');
    } else {
        imageSection.classList.remove('scrolled');
    }
});
// ‡¶è‡¶á ‡¶Ö‡¶Ç‡¶∂‡¶ü‡¶ø ‡¶Ö‡¶¨‡¶∂‡ßç‡¶Ø‡¶á product.html ‡¶è‡¶∞ ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡ßç‡¶ü‡ßá‡¶∞ ‡¶≠‡ßá‡¶§‡¶∞ ‡¶•‡¶æ‡¶ï‡¶§‡ßá ‡¶π‡¶¨‡ßá
// window ‡¶Ö‡¶¨‡¶ú‡ßá‡¶ï‡ßç‡¶ü‡ßá ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®‡¶ü‡¶ø ‡¶è‡¶ï‡ßç‡¶∏‡¶™‡ßã‡¶ú ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá ‡¶Ø‡ßá‡¶® HTML ‡¶¨‡¶æ‡¶ü‡¶® ‡¶•‡ßá‡¶ï‡ßá ‡¶è‡¶ü‡¶ø ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü
window.addToCartFromDetails = function() {
    // ‡ßß. ‡¶™‡ßç‡¶∞‡ßü‡ßã‡¶ú‡¶®‡ßÄ‡ßü ‡¶§‡¶•‡ßç‡¶Ø ‡¶∏‡¶Ç‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡¶æ
    const name = document.getElementById('pTitle').innerText;
    const price = document.getElementById('pPrice').innerText.replace(' TK', '');
    const img = document.getElementById('mainImg').src;
    
    // ‡ß®. URL ‡¶•‡ßá‡¶ï‡ßá ‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü ‡¶Ü‡¶á‡¶°‡¶ø ‡¶∏‡¶Ç‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡¶æ (‡¶è‡¶ü‡¶ø ‡¶®‡¶æ ‡¶™‡¶æ‡¶†‡¶æ‡¶≤‡ßá Firebase error ‡¶¶‡¶ø‡¶¨‡ßá)
    const urlParams = new URLSearchParams(window.location.search);
    const productId = urlParams.get('id');

    // ‡ß©. ‡¶∏‡ßç‡¶ü‡¶ï ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶æ
    const cartBtn = document.getElementById('detailsAddToCartBtn');
    const isStockOut = cartBtn ? cartBtn.disabled : false;

    if (isStockOut) {
        alert("Sorry, this product is out of stock!");
        return;
    }

    // ‡ß™. ‡¶Æ‡ßá‡¶á‡¶® addToCart ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ‡¶ï‡¶≤ ‡¶ï‡¶∞‡¶æ (‡¶Ü‡¶á‡¶°‡¶ø‡¶∏‡¶π)
    if (typeof window.addToCart === "function") {
        if (!productId) {
            console.error("Product ID not found in URL!");
            return;
        }
        
        // ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶®‡¶æ‡¶Æ, ‡¶¶‡¶æ‡¶Æ, ‡¶õ‡¶¨‡¶ø ‡¶è‡¶¨‡¶Ç ‡¶Ü‡¶á‡¶°‡¶ø ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶ö‡ßç‡¶õ‡ßá
        window.addToCart(name, price, img, productId);
        
        alert("Product added to cart!"); 
    } else {
        console.error("Main addToCart function not found! Make sure script.js is loaded correctly.");
    }
};

// ‡ß®. ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
////start chat option js/////

// ‡ßß. ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü ‡¶â‡¶á‡¶®‡ßç‡¶°‡ßã ‡¶ì‡¶™‡ßá‡¶®/‡¶ï‡ßç‡¶≤‡ßã‡¶ú ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
window.toggleChat = function() {
    const chatWin = document.getElementById('nexus-chat-window');
    chatWin.classList.toggle('chat-hidden');
    document.getElementById('chat-notify').style.display = 'none';
};
// ‡ß®. ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
////start chat option js/////

// ‡ßß. ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü ‡¶â‡¶á‡¶®‡ßç‡¶°‡ßã ‡¶ì‡¶™‡ßá‡¶®/‡¶ï‡ßç‡¶≤‡ßã‡¶ú ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
window.toggleChat = function() {
    const chatWin = document.getElementById('nexus-chat-window');
    chatWin.classList.toggle('chat-hidden');
    document.getElementById('chat-notify').style.display = 'none';
};
// ‡ß®. ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
// ‡ßß. ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶è‡¶¨‡¶Ç ‡¶®‡¶æ‡¶Æ ‡¶®‡¶ø‡¶∞‡ßç‡¶ß‡¶æ‡¶∞‡¶£‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶∂‡¶ï‡ßç‡¶§‡¶ø‡¶∂‡¶æ‡¶≤‡ßÄ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
function getNexusUserData() {
    let user = JSON.parse(localStorage.getItem('currentUser')) || {};
    
    // ‡¶Ø‡¶¶‡¶ø ‡¶≤‡¶ó‡¶á‡¶® ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡ßá, ‡¶§‡¶¨‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶∏‡ßç‡¶•‡¶æ‡ßü‡ßÄ ‡¶ó‡ßá‡¶∏‡ßç‡¶ü ‡¶Ü‡¶á‡¶°‡¶ø ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßã
    if (!user.uid && !user.id) {
        let guestId = localStorage.getItem('chat_uid');
        if (!guestId) {
            guestId = "guest_" + Date.now();
            localStorage.setItem('chat_uid', guestId);
        }
        user.id = guestId;
        user.name = "Guest User";
    }
    
    return {
        id: user.uid || user.id,
        name: user.name || "Guest User"
    };
}

const nexusUser = getNexusUserData();

// ‡ß®. ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
window.sendNexusMessage = function() {
    const chatInput = document.getElementById('chat-input');
    const message = chatInput.value.trim();
    if (!message) return;

    const chatRef = ref(db, `chats/${nexusUser.id}/messages`);
    const newMsgRef = push(chatRef);
    
    const msgData = {
        sender: nexusUser.name,
        role: "user",
        text: message,
        status: "sent",
        timestamp: Date.now()
    };

    set(newMsgRef, msgData).then(() => {
        // ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶≤‡¶æ‡¶∏‡ßç‡¶ü ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
        set(ref(db, `chats/${nexusUser.id}/lastMessage`), {
            userName: nexusUser.name,
            lastText: message,
            timestamp: Date.now(),
            userId: nexusUser.id,
            unread: true
        });
        chatInput.value = '';
    });
};

// ‡ß©. ‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶≤-‡¶ü‡¶æ‡¶á‡¶Æ‡ßá ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶∞‡¶ø‡¶∏‡¶ø‡¶≠ ‡¶ï‡¶∞‡¶æ (‡¶∏‡¶†‡¶ø‡¶ï ‡¶™‡¶æ‡¶• ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá)
const userMessagesRef = ref(db, `chats/${nexusUser.id}/messages`);
onValue(userMessagesRef, (snapshot) => {
    const chatBody = document.getElementById('chat-messages');
    const data = snapshot.val();
    
    if (data) {
        chatBody.innerHTML = ''; 
        // Object.entries ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶õ‡¶ø ‡¶Ø‡¶æ‡¶§‡ßá msgId ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü
        Object.entries(data).forEach(([msgId, msg]) => {
            const div = document.createElement('div');
            div.className = msg.role === 'user' ? 'msg user-msg' : 'msg bot-msg';

            let pressTimer;

            // ‡¶¨‡ßç‡¶∞‡¶æ‡¶â‡¶ú‡¶æ‡¶∞‡ßá‡¶∞ ‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü ‡¶Æ‡ßá‡¶®‡ßÅ ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡¶æ
            div.oncontextmenu = (e) => {
    e.preventDefault();
    window.showCustomerDeleteMenu(e, String(nexusUser.id), String(msgId), msg.timestamp);
    return false;
};

            // ‡¶´‡ßã‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶≤‡¶Ç-‡¶™‡ßç‡¶∞‡ßá‡¶∏ (Touch)
            div.addEventListener('touchstart', (e) => {
                clearTimeout(pressTimer);
                pressTimer = setTimeout(() => {
                    // touch ‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶™‡¶ú‡¶ø‡¶∂‡¶® ‡¶™‡¶æ‡¶∏ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá
                    window.showCustomerDeleteMenu(e, nexusUser.id, msgId, msg.timestamp);
                }, 700);
            }, { passive: true });

            div.addEventListener('touchend', () => clearTimeout(pressTimer));
            div.addEventListener('touchmove', () => clearTimeout(pressTimer));
            
            // ‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶®‡ßç‡¶ü
            const span = document.createElement('span');
            span.innerText = msg.text;
            div.appendChild(span);

            // ‡¶®‡ßÄ‡¶≤ ‡¶ü‡¶ø‡¶ï (Seen Status)
            if (msg.role === 'user' && msg.status === 'seen') {
                const tick = document.createElement('i');
                tick.className = 'fas fa-check-double';
                tick.style.cssText = 'color: #34b7f1; font-size: 10px; margin-left: 5px;';
                div.appendChild(tick);
            }
            chatBody.appendChild(div);
        });
        chatBody.scrollTop = chatBody.scrollHeight;
    }
});

// ‡ß™. ‡¶ü‡¶æ‡¶á‡¶™‡¶ø‡¶Ç ‡¶è‡¶¨‡¶Ç ‡¶∏‡¶ø‡¶® ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶≤‡¶ú‡¶ø‡¶ï (‡¶è‡¶®‡ßç‡¶ü‡¶æ‡¶∞ ‡¶¨‡¶æ‡¶ü‡¶® ‡¶∏‡¶π)
const chatInputField = document.getElementById('chat-input');

if (chatInputField) {
    chatInputField.addEventListener('input', () => {
        set(ref(db, `chats/${nexusUser.id}/typing/user`), true);
        clearTimeout(window.typingTimeout);
        window.typingTimeout = setTimeout(() => {
            set(ref(db, `chats/${nexusUser.id}/typing/user`), false);
        }, 2000);
    });

    // ‡¶è‡¶®‡ßç‡¶ü‡¶æ‡¶∞ ‡¶¨‡¶æ‡¶ü‡¶®‡ßá ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã‡¶∞ ‡¶≤‡¶ú‡¶ø‡¶ï
    chatInputField.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault(); // ‡¶®‡¶§‡ßÅ‡¶® ‡¶≤‡¶æ‡¶á‡¶® ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡¶ì‡¶Ø‡¶º‡¶æ ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡¶¨‡ßá
            window.sendNexusMessage(); // ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ‡¶ï‡¶≤ ‡¶ï‡¶∞‡¶¨‡ßá
        }
    });
}

// ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶ü‡¶æ‡¶á‡¶™‡¶ø‡¶Ç ‡¶è‡¶¨‡¶Ç ‡¶Ö‡¶ü‡ßã ‡¶∏‡¶ø‡¶®
onValue(ref(db, `chats/${nexusUser.id}/typing/admin`), (snapshot) => {
    const isTyping = snapshot.val();
    const adminStatus = document.getElementById('admin-typing-status');
    if (adminStatus) adminStatus.style.display = isTyping ? 'block' : 'none';

    // ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü ‡¶ñ‡ßã‡¶≤‡¶æ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú Seen ‡¶ï‡¶∞‡¶æ
    onValue(ref(db, `chats/${nexusUser.id}/messages`), (msgSnapshot) => {
        const messages = msgSnapshot.val();
        if (messages) {
            Object.keys(messages).forEach(msgId => {
                if (messages[msgId].role === 'admin' && messages[msgId].status !== 'seen') {
                    set(ref(db, `chats/${nexusUser.id}/messages/${msgId}/status`), 'seen');
                }
            });
        }
    }, { onlyOnce: true });
});

window.showCustomerDeleteMenu = function(e, uid, msgId, msgTimestamp) {
    if (!msgTimestamp) return;

    const currentTime = Date.now();
    // ‡¶Æ‡¶ø‡¶≤‡¶ø‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶•‡ßá‡¶ï‡ßá ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°‡ßá ‡¶™‡¶æ‡¶∞‡ßç‡¶•‡¶ï‡ßç‡¶Ø ‡¶¨‡ßá‡¶∞ ‡¶ï‡¶∞‡¶æ
    const diffInSeconds = (currentTime - msgTimestamp) / 1000;
    
    console.log("Diff in seconds:", diffInSeconds);

    // ‡ßß‡ß¶ ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü = ‡ß¨‡ß¶‡ß¶ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°
    if (diffInSeconds > 600) { 
        console.log("‡¶∏‡¶Æ‡ßü ‡¶™‡¶æ‡¶∞ ‡¶π‡ßü‡ßá ‡¶ó‡ßá‡¶õ‡ßá (‡ßß‡ß¶ ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü ‡¶≤‡¶ø‡¶Æ‡¶ø‡¶ü)!");
        alert("‡ßß‡ß¶ ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü ‡¶™‡¶æ‡¶∞ ‡¶π‡ßü‡ßá ‡¶Ø‡¶æ‡¶ì‡ßü‡¶æ‡ßü ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú‡¶ü‡¶ø ‡¶Ü‡¶∞ ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶∏‡¶Æ‡ßç‡¶≠‡¶¨ ‡¶®‡ßü‡•§");
        return; 
    }

    // ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶ï‡ßã‡¶®‡ßã ‡¶Æ‡ßá‡¶®‡ßÅ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶∏‡¶∞‡¶ø‡ßü‡ßá ‡¶´‡ßá‡¶≤‡¶æ
    const oldMenu = document.querySelector('.custom-context-menu');
    if (oldMenu) oldMenu.remove();

    const menu = document.createElement('div');
    menu.className = 'custom-context-menu';
    
    // ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶è‡¶¨‡¶Ç ‡¶™‡¶ø‡¶∏‡¶ø‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶∏‡¶†‡¶ø‡¶ï ‡¶™‡¶ú‡¶ø‡¶∂‡¶® ‡¶¨‡ßá‡¶∞ ‡¶ï‡¶∞‡¶æ
let posX, posY;
if (e.touches && e.touches[0]) {
    // ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶ü‡¶æ‡¶ö ‡¶™‡¶ú‡¶ø‡¶∂‡¶®
    posX = e.touches[0].clientX;
    posY = e.touches[0].clientY;
} else {
    // ‡¶™‡¶ø‡¶∏‡¶ø ‡¶Æ‡¶æ‡¶â‡¶∏ ‡¶™‡¶ú‡¶ø‡¶∂‡¶®
    posX = e.clientX;
    posY = e.clientY;
}

// ‡¶Æ‡ßá‡¶®‡ßÅ ‡¶Ø‡ßá‡¶® ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶®‡ßá‡¶∞ ‡¶¨‡¶æ‡¶á‡¶∞‡ßá ‡¶®‡¶æ ‡¶Ø‡¶æ‡ßü (‡¶°‡¶æ‡¶® ‡¶•‡ßá‡¶ï‡ßá ‡¶¨‡¶æ‡¶Æ‡ßá ‡¶®‡¶ø‡ßü‡ßá ‡¶Ü‡¶∏‡¶æ)
const menuWidth = 180; // ‡¶Æ‡ßá‡¶®‡ßÅ‡¶∞ ‡¶Ü‡¶®‡ßÅ‡¶Æ‡¶æ‡¶®‡¶ø‡¶ï ‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶•
const screenWidth = window.innerWidth;

if (posX + menuWidth > screenWidth) {
    posX = posX - menuWidth; // ‡¶Ø‡¶¶‡¶ø ‡¶°‡¶æ‡¶® ‡¶¶‡¶ø‡¶ï‡ßá ‡¶ú‡¶æ‡ßü‡¶ó‡¶æ ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡ßá, ‡¶§‡¶¨‡ßá ‡¶¨‡¶æ‡¶Æ‡ßá ‡¶∏‡¶∞‡¶¨‡ßá
}

menu.style.cssText = `
    position: fixed !important;
    top: ${posY}px;
    left: ${posX}px;
    background: #1a1a1a;
    border: 1px solid #d4af37;
    z-index: 10000000 !important;
    padding: 10px;
    border-radius: 8px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.8);
    color: white;
    cursor: pointer;
    min-width: ${menuWidth}px; /* ‡¶¨‡¶ï‡ßç‡¶∏‡ßá‡¶∞ ‡¶∏‡¶æ‡¶á‡¶ú ‡¶®‡¶ø‡¶∞‡ßç‡¶¶‡¶ø‡¶∑‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶≤‡ßã */
    white-space: nowrap; /* ‡¶≤‡ßá‡¶ñ‡¶æ ‡¶Ø‡ßá‡¶® ‡¶®‡¶æ ‡¶≠‡¶æ‡¶ô‡ßç‡¶ó‡ßá */
`;

    menu.innerHTML = `<div onclick="window.customerDeleteForEveryone('${uid}', '${msgId}')" 
    style="color: #ff4d4d; font-weight: bold; white-space: nowrap; font-size: 14px; display: flex; align-items: center; justify-content: center; gap: 8px;">
    üî• Delete for Everyone
    </div>`;
    
    document.body.appendChild(menu);

    // ‡¶Æ‡ßá‡¶®‡ßÅ‡¶∞ ‡¶¨‡¶æ‡¶á‡¶∞‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡¶≤‡ßá ‡¶∏‡ßá‡¶ü‡¶ø ‡¶¨‡¶®‡ßç‡¶ß ‡¶π‡ßü‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá
    setTimeout(() => {
        const closeMenu = () => {
            menu.remove();
            document.removeEventListener('click', closeMenu);
        };
        document.addEventListener('click', closeMenu);
    }, 100);
};
window.customerDeleteForEveryone = function(uid, msgId) {
    if (!uid || !msgId) return;

    if (confirm("‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶Ø‡ßá ‡¶è‡¶á ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú‡¶ü‡¶ø ‡¶∏‡¶¨‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶¨‡ßá‡¶®?")) {
        // ‡¶´‡¶æ‡ßü‡¶æ‡¶∞‡¶¨‡ßá‡¶∏ ‡¶™‡¶æ‡¶• (Path)
        const pathStr = `chats/${uid}/messages/${msgId}`;
        
        // ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶∏‡¶∞‡¶æ‡¶∏‡¶∞‡¶ø ‡¶á‡¶Æ‡ßç‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶Æ‡¶°‡¶ø‡¶â‡¶≤ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶õ‡¶ø
        // ‡¶Æ‡¶®‡ßá ‡¶∞‡¶æ‡¶ñ‡¶¨‡ßá: ‡¶Æ‡¶°‡¶ø‡¶â‡¶≤ ‡¶∏‡ßç‡¶ï‡ßã‡¶™‡ßá‡¶∞ ‡¶≠‡ßá‡¶§‡¶∞‡ßá ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ref ‡¶è‡¶¨‡¶Ç remove ‡¶∏‡¶∞‡¶æ‡¶∏‡¶∞‡¶ø ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶¨‡ßá
        try {
            const messageRef = ref(db, pathStr);
            
            remove(messageRef)
                .then(() => {
                    console.log("‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
                    // ‡¶™‡¶™-‡¶Ü‡¶™ ‡¶Æ‡ßá‡¶®‡ßÅ ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡¶æ
                    const menu = document.querySelector('.custom-context-menu');
                    if (menu) menu.remove();
                })
                .catch((error) => {
                    console.error("Firebase Remove Error:", error);
                    alert("‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá: " + error.message);
                });
        } catch (err) {
            console.error("Reference Error:", err);
            alert("‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ ‡¶è‡¶∞‡¶∞! ‡¶™‡ßá‡¶ú‡¶ü‡¶ø ‡¶è‡¶ï‡¶¨‡¶æ‡¶∞ ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶¶‡¶ø‡¶®‡•§");
        }
    }
};
///End chat js///
</script>
<script type="module" src="script.js"></script>
</body>
</html>